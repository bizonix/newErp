{include file="header.htm"}
<div class="fourvar">
            	<div class="pathvar">
                {include file='pcNav.htm'}
                </div>
                <div class="texvar">
                </div>
                <div class="pagination">
                </div>
            </div>
            <div class="main products-main">                    
					<table class="products-action" width="100%" border="0" cellpadding="0" cellspacing="0">
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">&nbsp;</span>状态：</td>
							<td align="left">
                            <input disabled="disabled" value="{if $spuModifyRecord['status'] == 1}待处理{elseif $spuModifyRecord['status'] == 2}处理中{elseif $spuModifyRecord['status'] == 3}已处理{/if}"/>
							</td>
						</tr>
						<tr>
                            <td align="right" width="200px"><span style="color:#F00;">&nbsp;</span>SPU：</td>
							<td align="left">
                            <input disabled="disabled" value="{$spuModifyRecord['spu']}"/>
                            <input type="hidden" id="spuModifyRecordId" value="{$spuModifyRecord['id']}"/>
                            <input type="hidden" id="spu" value="{$spuModifyRecord['spu']}"/>
							</td>
						</tr>
                        <tr>
                       	    <td align="right" width="200px">
                                <span style="color:#F00;">&nbsp;</span>所关联的虚拟SPU：
                            </td>
                            <td align="left">
								<textarea disabled="disabled" cols="60" rows="3">{$spuModifyRecord['combineSpuRelativeContent']}</textarea>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">&nbsp;</span>修改/优化：</td>
                            <td align="left">
                                 <select disabled="disabled">
                                    <option value=""></option>
                                    <option value="1" {if $spuModifyRecord['recordType'] == 1}selected="selected"{/if}>修改</option>
                                    <option value="2" {if $spuModifyRecord['recordType'] == 2}selected="selected"{/if}>优化</option>
                                 </select>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">&nbsp;</span>产品工程师：</td>
							<td align="left">
                            <input disabled="disabled" value="{getPersonNameById($spuModifyRecord['PEId'])}"/>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">&nbsp;</span>各平台销售人员：</td>
							<td align="left">
                            <a href="index.php?mod=autoCreateSpu&act=getAutoCreateSpuList&spu={$spuModifyRecord['spu']}" target="_blank">点击查看详情</a>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">&nbsp;</span>QC检测员：</td>
							<td align="left">
                            <input disabled="disabled" value="" id="qcUser"/>
							</td>
						</tr>                           
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">&nbsp;</span>修改类型：</td>
                            <td align="left">
                                 <textarea disabled="disabled" cols="60" rows="3">{$spuModifyRecord['modifyTypeName']}</textarea>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">&nbsp;</span>修改内容：</td>
                            <td align="left">
                                {if !empty($spuModifyRecord['modityContent'])}
                                <div style="width: 80%;">
                                    {base64_decode($spuModifyRecord['modityContent'])}
                                </div>
                                {else}
                                <textarea disabled="disabled" cols="60" rows="3"></textarea>
                                {/if}                                 
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">&nbsp;</span>备注：</td>
                            <td align="left">
                                 <textarea disabled="disabled" cols="60" rows="3" name="note" id="note">{$spuModifyRecord['note']}</textarea>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;"></span>修订内容：</td>
                            <td align="left">
                                {if !empty($spuModifyRecord['appendContent1'])}
                                <div style="background-color: #EBEBE4;width: 80%;">
                                    {base64_decode($spuModifyRecord['appendContent1'])}
                                </div>
                                {else}
                                <textarea disabled="disabled" cols="60" rows="3"></textarea>
                                {/if}                                
							</td>
						</tr>
                        {if $smarty.session.userId == $spuModifyRecord['PEId'] && $spuModifyRecord['status'] == 2}
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">*</span>是否重拍图片：</td>
                            <td align="left">
                                 <select id="isRephoto" name="isRephoto">
                                    <option value=""></option>
                                    <option value="1">不重拍</option>
                                    <option value="2">重拍</option>
                                 </select>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">*</span>图片张数：</td>
                            <td align="left">
                                 <input id="photoCount" value=""/>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">*</span>是否修改描述：</td>
                            <td align="left">
                                 <select id="isModityDescri">
                                    <option value=""></option>
                                    <option value="1">不修改</option>
                                    <option value="2">修改</option>
                                 </select>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">*</span>是否添加子料号：</td>
                            <td align="left">
                                 <select id="isAddSku">
                                    <option value=""></option>
                                    <option value="1">不添加</option>
                                    <option value="2">添加</option>
                                 </select>
							</td>
						</tr>
                        {/if}
                        {if $spuModifyRecord['status'] == 3}
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">*</span>是否重拍图片：</td>
                            <td align="left">
                                 <select disabled="disabled">
                                    <option value=""></option>
                                    <option value="1" {if $spuModifyRecord['isRephoto'] == 1}selected="selected"{/if}>不重拍</option>
                                    <option value="2" {if $spuModifyRecord['isRephoto'] == 2}selected="selected"{/if}>重拍</option>
                                 </select>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">*</span>图片张数：</td>
                            <td align="left">
                                 <input disabled="disabled" value="{$spuModifyRecord['photoCount']}"/>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">*</span>是否修改描述：</td>
                            <td align="left">
                                 <select disabled="disabled">
                                    <option value=""></option>
                                    <option value="1" {if $spuModifyRecord['isModityDescri'] == 1}selected="selected"{/if}>不修改</option>
                                    <option value="2" {if $spuModifyRecord['isModityDescri'] == 2}selected="selected"{/if}>修改</option>
                                 </select>
							</td>
						</tr>
                        <tr>
                            <td align="right" width="200px"><span style="color:#F00;">*</span>是否添加子料号：</td>
                            <td align="left">
                                 <select disabled="disabled">
                                    <option value=""></option>
                                    <option value="1" {if $spuModifyRecord['isAddSku'] == 1}selected="selected"{/if}>不添加</option>
                                    <option value="2" {if $spuModifyRecord['isAddSku'] == 2}selected="selected"{/if}>添加</option>
                                 </select>
							</td>
						</tr>
                        {/if}
                        <tr>                        
							<td colspan="2">
                            {if $smarty.session.userId == $spuModifyRecord['PEId']}
                                {if $spuModifyRecord['status'] == 1}
                                    <input type="button" value="领取" id="takeSpuModifyRecord" recordId="{$spuModifyRecord['id']}"/>
                                {/if}
                                {if $spuModifyRecord['status'] == 2}
                                    <input type="button" value="完成" id="completeSpuModifyRecord" recordId="{$spuModifyRecord['id']}"/>
                                {/if}
                            {/if}
                            </td>
						</tr>
					</table>
            </div>
            <div class="bottomvar">
            	<div class="texvar">

            	</div>
            	<div class="pagination">
            	</div>
            </div>
{include file="footer.htm"}
<script type="text/javascript">  
document.all.contentEditable =true;      
        $(document).ready(function(){
            var spu = $('#spu').val();
            $.ajax({
				type	: "POST",
				dataType: "jsonp",
				url		: 'json.php?mod=goods&act=getSpuQcUserBySpu&jsonp=1',
				data	: { spu:spu },
				success	: function (msg){
					if(msg.errCode == '200'){
                        $('#qcUser').val(msg.data);
					}
				}
			});
            
            $("#takeSpuModifyRecord").click(function(){
                if(confirm('确认领取？')){
                    var id = $(this).attr('recordId');
                    if(isNaN(id)){
                        $("#error").html('无效记录');
                        return;
                    }
                    
                    $.ajax({
        				type	: "POST",
        				dataType: "jsonp",
        				url		: 'json.php?mod=goods&act=takeSpuModifyRecordById&jsonp=1',
        				data	: { id:id },
        				success	: function (msg){
        				    alert(msg.errMsg);
        					if(msg.errCode == '200'){
                                location.reload();
        					}
        				}
        			});
                }  
            });
            
            $("#completeSpuModifyRecord").click(function(){
                var id = $(this).attr('recordId');
                var isRephoto = $('#isRephoto').val();
                var photoCount = $('#photoCount').val();
                var isModityDescri = $('#isModityDescri').val();
                var isAddSku = $('#isAddSku').val();
                if(isNaN(id)){
                    alert('无效记录');
                    return;
                }
                if(isNaN(isRephoto) || isRephoto == 0){
                    alert('是否重拍信息有误');
                    return;
                }
                if(!(/^(\+|-)?\d+$/.test(photoCount)) || photoCount <= 0){
                    alert("图片张数必须是正整数");   
                    return ;                      
                }
                if(isNaN(isModityDescri) || isModityDescri == 0){
                    alert('是否修改描述信息有误');
                    return;
                }
                if(isNaN(isAddSku) || isAddSku == 0){
                    alert('是否添加子料号信息有误');
                    return;
                }
                var comfirmStr = "";
                comfirmStr += "是否重拍图片：";
                if(isRephoto == 1){
                    comfirmStr += "不重拍，";
                }else{
                    comfirmStr += "重拍，";
                }
                comfirmStr += "图片张数:"+photoCount+"，";
                comfirmStr += "是否修改描述：";
                if(isModityDescri == 1){
                    comfirmStr += "不修改。";
                }else{
                    comfirmStr += "修改。";
                }
                comfirmStr += "是否添加子料号：";
                if(isAddSku == 1){
                    comfirmStr += "不添加。";
                }else{
                    comfirmStr += "添加。";
                }
                comfirmStr += "\n";
                comfirmStr += "确认完成？";
                if(confirm(comfirmStr)){                    
                    $.ajax({
        				type	: "POST",
        				dataType: "jsonp",
        				url		: 'json.php?mod=goods&act=completeSpuModifyRecordById&jsonp=1',
        				data	: { id:id,isRephoto:isRephoto,photoCount:photoCount,isModityDescri:isModityDescri,isAddSku:isAddSku },
        				success	: function (msg){
        				    alert(msg.errMsg);
        					if(msg.errCode == '200'){
                                location.reload();
        					}
        				}
        			});
                }  
            });
        });       
</script>